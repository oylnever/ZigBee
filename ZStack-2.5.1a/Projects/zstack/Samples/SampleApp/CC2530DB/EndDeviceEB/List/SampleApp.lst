###############################################################################
#
# IAR C/C++ Compiler V10.30.1.6000 for 8051               04/Sep/2021  20:35:00
# Copyright 2004-2018 IAR Systems AB.
# PC-locked license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
#    Command line       =  
#        -f C:\Users\OY\AppData\Local\Temp\EWEFDD.tmp
#        (C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
#        -D NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC
#        -D LCD_SUPPORTED=DEBUG -lC
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\List
#        -lA
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\List
#        --diag_suppress Pe001,Pa010 -o
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\Obj
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 8 -f
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3
#        -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg
#        (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00000800 -DZDAPP_CONFIG_PAN_ID=0xFFF1
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07,
#        0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C,
#        0x0D}" -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=20
#        "-DCONST=const __code" -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE
#        -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100
#        -DREJOIN_POLL_RATE=440) -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\Source\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\ZMain\TI2530DB\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\hal\include\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\include\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\high_level\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\mt\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\osal\include\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\services\saddr\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\services\sdata\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\af\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\nwk\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\sapi\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\sec\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\sys\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\stack\zdo\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\zmac\
#        -I
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\..\..\..\..\Components\zmac\f8w\
#        -Ohz --no_code_motion)
#    Locale             =  Chinese (Simplified)_CHN.936
#    List file          =  
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\List\SampleApp.lst
#    Object file        =  
#        C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\EndDeviceEB\Obj\SampleApp.r51
#
###############################################################################

C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
      1          /*********************************************************************
      2           * INCLUDES
      3           */
      4          
      5          #include <stdio.h>
      6          #include <string.h>
      7          #include "AF.h"
      8          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1
      9          #include "OSAL_Tasks.h"
     10          #include "SampleApp.h"
     11          #include "ZDApp.h"
     12          #include "ZDObject.h"
     13          #include "ZDProfile.h"
     14          
     15          #include "hal_drivers.h"
     16          #include "hal_key.h"
     17          #if defined(LCD_SUPPORTED)
     18          #include "hal_lcd.h"
     19          #endif
     20          #include "hal_led.h"
     21          #include "hal_uart.h"
     22          
     23          #ifdef ZDO_COORDINATOR
     24          //协议文件
     25          #include "mqtt.h"
     26          #include "mqttkit.h"
     27          
     28          #else
     29          
     30          #include "dht11.h"
     31          
     32          #endif
     33          
     34          /*********************************************************************
     35           * MACROS
     36           */
     37          
     38          /*********************************************************************
     39           * CONSTANTS
     40           */
     41          
     42          #if !defined(SAMPLE_APP_PORT)
     43          #define SAMPLE_APP_PORT 0
     44          #endif
     45          
     46          #if !defined(SAMPLE_APP_RX_MAX)
     47          #define SAMPLE_APP_RX_MAX 200
     48          #endif
     49          
     50          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     51          const cId_t SampleApp_ClusterList[SAMPLE_MAX_CLUSTERS] =
   \                     SampleApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
   \   000004   0300         DW 3
   \   000006   0400         DW 4
     52              {
     53                  SAMPLEAPP_P2P_CLUSTERID,
     54                  SAMPLEAPP_PERIODIC_CLUSTERID,
     55                  SERIALAPP_CONNECTREQ_CLUSTER,
     56                  SAMPLEAPP_CTE_CLUSTERID // coor to end
     57          };
     58          

   \                                 In  segment XDATA_ROM_C, align 1
     59          const SimpleDescriptionFormat_t SampleApp_SimpleDesc =
   \                     SampleApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F         DW 3845
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   04           DB 4
   \   000007   ....         DW SampleApp_ClusterList
   \   000009   04           DB 4
   \   00000A   ....         DW SampleApp_ClusterList
     60              {
     61                  SAMPLEAPP_ENDPOINT,             //  int   Endpoint;
     62                  SAMPLEAPP_PROFID,               //  uint16 AppProfId[2];
     63                  SAMPLEAPP_DEVICEID,             //  uint16 AppDeviceId[2];
     64                  SAMPLEAPP_DEVICE_VERSION,       //  int   AppDevVer:4;
     65                  SAMPLEAPP_FLAGS,                //  int   AppFlags:4;
     66                  SAMPLE_MAX_CLUSTERS,            //  byte  AppNumInClusters;
     67                  (cId_t *)SampleApp_ClusterList, //  byte *pAppInClusterList;
     68                  SAMPLE_MAX_CLUSTERS,            //  byte  AppNumOutClusters;
     69                  (cId_t *)SampleApp_ClusterList  //  byte *pAppOutClusterList;
     70          };
     71          

   \                                 In  segment XDATA_I, align 1, keep-with-next
     72          endPointDesc_t SampleApp_epDesc =
   \                     SampleApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for SampleApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
     73              {
     74                  SAMPLEAPP_ENDPOINT,
     75                  &SampleApp_TaskID,
     76                  (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc,
     77                  noLatencyReqs};
     78          
     79          /*********************************************************************
     80           * TYPEDEFS
     81           */
     82          
     83          /*********************************************************************
     84           * GLOBAL VARIABLES
     85           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     86          devStates_t SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     87          uint8 SampleApp_TaskID; // Task ID for internal task/event processing.
   \                     SampleApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     88          
     89          /*********************************************************************
     90           * EXTERNAL VARIABLES
     91           */
     92          
     93          /*********************************************************************
     94           * EXTERNAL FUNCTIONS
     95           */
     96          
     97          /*********************************************************************
     98           * LOCAL VARIABLES
     99           */
    100          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    101          static uint8 SampleApp_MsgID; //消息id
   \                     SampleApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    102          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    103          afAddrType_t SampleApp_P2P_DstAddr; //播类型
   \                     SampleApp_P2P_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    104          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    105          static uint8 SampleApp_RxBuf[SAMPLE_APP_RX_MAX + 1] = {0};
   \                     SampleApp_RxBuf:
   \   000000                DS 201
   \   0000C9                REQUIRE __INIT_XDATA_Z
    106          static uint16 SampleApp_RxLen = 0;
    107          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    108          uint8 onenet_login_ok = 0; //onenet注册成功 0:未注册，1：注册中　2：注册成功
   \                     onenet_login_ok:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    109          uint8 end_temp;            //终端的温度
   \                     end_temp:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    110          uint8 end_hum;             //终端的湿度
   \                     end_hum:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    111          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    112          uint8 end_light = 0;     //开发板区域亮度     亮0-127灭
   \                     end_light:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    113          uint8 end_led2 = 0;      //终端节点开发板led3状态     0灭 1亮
   \                     end_led2:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    114          uint8 cor_led3 = 0;      //协调器led3 0灭 1亮
   \                     cor_led3:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    115          uint8 end_obstacles = 0; //终端障碍物 0无障碍(输出高电平） 1有障碍(低电平)
   \                     end_obstacles:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    116          uint8 end_buzzer = 0;    //buzzer 0不响 1响起
   \                     end_buzzer:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          uint8 end_smoke = 0;     //烟雾浓度0-127 浓度越高电压越高5V
   \                     end_smoke:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    118          #ifdef ZDO_COORDINATOR
    119          signed char *g_mqtt_topics_set[5] = {NULL};
    120          u8 topics_buff[60] = {0};
    121          u8 topics_post[100] = {0};  //发布的主题
    122          u8 mqtt_message[200] = {0}; //发布的消息
    123          #endif
    124          
    125          /*********************************************************************
    126           * LOCAL FUNCTIONS
    127           */
    128          
    129          static void SampleApp_ProcessMSGCmd(afIncomingMSGPacket_t *pkt);
    130          void SampleApp_CallBack(uint8 port, uint8 event);
    131          static void SampleApp_Send_P2P_Message(void);
    132          static void OneNet_publish_topic();
    133          void debug(uint8 *msg, ...);
    134          
    135          /*********************************************************************
    136           * @fn      SampleApp_Init
    137           *
    138           * @brief   This is called during OSAL tasks' initialization.
    139           *
    140           * @param   task_id - the Task ID assigned by OSAL.
    141           *
    142           * @return  none
    143           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    144          void SampleApp_Init(uint8 task_id)
   \                     SampleApp_Init:
    145          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
   \   000006   FE           MOV       R6,A
    146            halUARTCfg_t uartConfig;
    147          
    148            SampleApp_TaskID = task_id;
   \   000007   90....       MOV       DPTR,#SampleApp_TaskID
   \   00000A   F0           MOVX      @DPTR,A
    149            SampleApp_NwkState = DEV_INIT;
   \   00000B   90....       MOV       DPTR,#SampleApp_NwkState
   \   00000E   7401         MOV       A,#0x1
   \   000010   F0           MOVX      @DPTR,A
    150          
    151            MT_UartInit();                  //串口初始化
                   ^
Warning[Pe223]: function "MT_UartInit" declared implicitly
   \   000011                ; Setup parameters for call to function MT_UartInit
   \   000011   12....       LCALL     `??MT_UartInit::?relay`; Banked call to: MT_UartInit
    152            MT_UartRegisterTaskID(task_id); //注册串口任务
                   ^
Warning[Pe223]: function "MT_UartRegisterTaskID" declared implicitly
   \   000014                ; Setup parameters for call to function MT_UartRegisterTaskID
   \   000014   EE           MOV       A,R6
   \   000015   FA           MOV       R2,A
   \   000016   7B00         MOV       R3,#0x0
   \   000018   12....       LCALL     `??MT_UartRegisterTaskID::?relay`; Banked call to: MT_UartRegisterTaskID
    153            afRegister((endPointDesc_t *)&SampleApp_epDesc);
   \   00001B                ; Setup parameters for call to function afRegister
   \   00001B   7A..         MOV       R2,#SampleApp_epDesc & 0xff
   \   00001D   7B..         MOV       R3,#(SampleApp_epDesc >> 8) & 0xff
   \   00001F   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    154            RegisterForKeys(task_id);
   \   000022                ; Setup parameters for call to function RegisterForKeys
   \   000022   EE           MOV       A,R6
   \   000023   F9           MOV       R1,A
   \   000024   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    155          
    156          #ifdef ZDO_COORDINATOR
    157            //协调器初始化
    158          
    159            //逢蜂鸣器初始化
    160            //  P0SEL &= ~0x80;                 //设置P07为普通IO口
    161            //  P0DIR |= 0x80;                 //P07定义为输出口
    162            //
    163            //  //默认蜂鸣器不响
    164            //  P0_7=1;
    165          
    166            //初始化发布的主题
    167            sprintf(topics_post, "/post"); //"/sys/%s/%s/thing/event/property/post",ProductKey,DeviceName);
    168          
    169            //初始化订阅的主题
    170            sprintf(topics_buff, "/set"); //"/sys/%s/%s/thing/service/property/set",ProductKey,DeviceName);// /sys/a1sYYwS4kmH/mytestdev/thing/service/property/set
    171            g_mqtt_topics_set[0] = topics_buff;
    172          
    173            //协调器广播给终端
    174            SampleApp_P2P_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast; //广播模式
    175            SampleApp_P2P_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
    176            SampleApp_P2P_DstAddr.addr.shortAddr = 0xFFFF; //发给终端
    177          
    178            //目的地址端口号
    179            endPointDesc_t SampleApp_epDesc;
    180            SampleApp_epDesc.endPoint = SAMPLEAPP_ENDPOINT;
    181            SampleApp_epDesc.task_id = &SampleApp_TaskID;
    182            SampleApp_epDesc.simpleDesc = (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc;
    183            SampleApp_epDesc.latencyReq = noLatencyReqs;
    184            afRegister(&SampleApp_epDesc);
    185          
    186          #else
    187            //终端点播给协调器
    188            SampleApp_P2P_DstAddr.addrMode = (afAddrMode_t)Addr16Bit; //点播
   \   000027   90....       MOV       DPTR,#SampleApp_P2P_DstAddr + 8
   \   00002A   7402         MOV       A,#0x2
   \   00002C   F0           MOVX      @DPTR,A
    189            SampleApp_P2P_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   00002D   A3           INC       DPTR
   \   00002E   740B         MOV       A,#0xb
   \   000030   F0           MOVX      @DPTR,A
    190            SampleApp_P2P_DstAddr.addr.shortAddr = 0x0000; //发给协调器
   \   000031   90....       MOV       DPTR,#SampleApp_P2P_DstAddr
   \   000034   E4           CLR       A
   \   000035   F0           MOVX      @DPTR,A
   \   000036   A3           INC       DPTR
   \   000037   F0           MOVX      @DPTR,A
    191                                                           //初始化相关的模块连接的引脚 P0_4_5 通用io 输出 检查拉低与否
    192            P0SEL &= 0xCF;                                 //    11001111
   \   000038   53F3CF       ANL       0xf3,#0xcf
    193            P0DIR |= 0x00;                                 //0_5输入，无障碍物时被拉高      1输出    00010000
   \   00003B   85FDFD       MOV       0xfd,0xfd
    194          
    195          #endif
    196          }
   \   00003E   7F01         MOV       R7,#0x1
   \   000040   02....       LJMP      ?BANKED_LEAVE_XDATA
   \   000043                REQUIRE P0SEL
   \   000043                REQUIRE P0DIR
    197          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    198          void SampleApp_HandleKeys(uint8 shift, uint8 keys)
   \                     SampleApp_HandleKeys:
    199          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    200            (void)shift; // Intentionally unreferenced parameter
    201          
    202          #if defined(ZDO_COORDINATOR)
    203          
    204            if (keys & HAL_KEY_SW_6) //key1
    205            {
    206              const signed char *g_mqtt_topics[] = {"mqtt_topic_test1"};
    207              if (0 == mqtt_subscribe_topic(g_mqtt_topics, 1))
    208              {
    209              }
    210            }
    211          
    212            if (keys & HAL_KEY_SW_1) //key2
    213            {
    214            }
    215          
    216          #endif
    217          }
   \   000000   02....       LJMP      ?BRET
    218          
    219          /*********************************************************************
    220           * @fn      SampleApp_ProcessEvent
    221           *
    222           * @brief   Generic Application Task event processor.
    223           *
    224           * @param   task_id  - The OSAL assigned task ID.
    225           * @param   events   - Bit map of events to process.
    226           *
    227           * @return  Event flags of all unprocessed events.
    228           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    229          UINT16 SampleApp_ProcessEvent(uint8 task_id, UINT16 events)
   \                     SampleApp_ProcessEvent:
    230          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    231            (void)task_id; // Intentionally unreferenced parameter
    232          
    233            if (events & SYS_EVENT_MSG)
   \   000009   5480         ANL       A,#0x80
   \   00000B   7051         JNZ       ??SampleApp_ProcessEvent_0
    234            {
    235              afIncomingMSGPacket_t *MSGpkt;
    236          
    237              while ((MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive(SampleApp_TaskID)))
    238              {
    239                switch (MSGpkt->hdr.event)
    240                {
    241                case KEY_CHANGE:
    242                  SampleApp_HandleKeys(((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys);
    243                  break;
    244          
    245                case AF_INCOMING_MSG_CMD:
    246                  SampleApp_ProcessMSGCmd(MSGpkt);
    247                  break;
    248          
    249                case ZDO_STATE_CHANGE:
    250                  SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    251                  if ((SampleApp_NwkState == DEV_ZB_COORD) ||
    252                      (SampleApp_NwkState == DEV_ROUTER) || (SampleApp_NwkState == DEV_END_DEVICE))
    253                  {
    254                    //连网成功后，启动一个定时器
    255                    osal_start_timerEx(SampleApp_TaskID,
    256                                       SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    257                                       SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT);
    258                  }
    259                  else
    260                  {
    261                    // Device is no longer in the network
    262                  }
    263                  break;
    264          
    265                default:
    266                  break;
    267                }
    268          
    269                osal_msg_deallocate((uint8 *)MSGpkt);
    270              }
    271          
    272              return (events ^ SYS_EVENT_MSG);
    273            }
    274          
    275          #ifdef ZDO_COORDINATOR
    276          
    277            //定时器时间到
    278            if (events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT)
    279            {
    280              if (onenet_login_ok == 2)
    281              {
    282                //如果接入onenet成功，启动心跳和发送数据定A器
    283          
    284                P1_1 = 0; //点亮D2
    285          
    286                // 启动心跳定时器，15秒一次
    287                osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_ONENET_HEART_BEAT_EVT, 15000);
    288          
    289                // 启动发送数据定时器，5秒一次
    290                osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_ONENET_SEND_DATA_EVT, 5000);
    291              }
    292              else
    293              {
    294                onenet_login_ok = 1; //onenet注册成功 0:未注册，1：注册中　2：注册成功
    295                SampleApp_RxLen = 0;
    296          
    297                //如果没有接入onenet成功，重新发起接入
    298                OneNet_DevLink(); //接入onenet服务器
    299          
    300                //LED2闪，表示正在接入onenet
    301                HalLedBlink(HAL_LED_2, 5, 50, 500);
    302          
    303                // 每5秒尝试接入一次
    304                osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT, 5000);
    305              }
    306          
    307              // return unprocessed events
    308              return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
    309            }
    310          
    311            //心跳定时器时间到
    312            if (events & SAMPLEAPP_ONENET_HEART_BEAT_EVT)
    313            {
    314              if (onenet_login_ok == 2)
    315              {
    316                //发送心跳
    317                onenet_mqtt_send_heart();
    318              }
    319          
    320              // 启动心跳定时器，15秒一次
    321              osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_ONENET_HEART_BEAT_EVT, 15000);
    322          
    323              // return unprocessed events
    324              return (events ^ SAMPLEAPP_ONENET_HEART_BEAT_EVT);
    325            }
    326          
    327            //发送数据定时器时间到
    328            if (events & SAMPLEAPP_ONENET_SEND_DATA_EVT)
    329            {
    330              if (onenet_login_ok == 2)
    331              {
    332                //发送温湿度数据到onenet
    333                //    OneNet_SendData(end_temp, end_hum);
    334          
    335                sprintf(mqtt_message,
    336                        "{\"method\":\"thing.service.property.set\",\"id\":\"630262306\",\"params\":{\
    337                      \"temp\":%d,\
    338                      \"hum\":%d,\
    339                         \"end_light\":%d,\
    340                        \"end_led2\":%d,\
    341          			  \"end_obstacles\":%d,\
    342                    \"end_smoke\":%d }\
    343                  }",
    344                        end_temp,
    345                        end_hum,
    346                        end_light,
    347                        end_led2,
    348                        end_obstacles,
    349                        end_smoke);
    350          
    351                //发布主题
    352                mqtt_publish_topic(topics_post, mqtt_message);
    353          
    354                //  OneNet_publish_topic();
    355              }
    356          
    357              // 启动发送数据定时器，5秒一次
    358              osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_ONENET_SEND_DATA_EVT, 5000);
    359          
    360              // return unprocessed events
    361              return (events ^ SAMPLEAPP_ONENET_SEND_DATA_EVT);
    362            }
    363          
    364          #else
    365          
    366            //定时器时间到
    367            if (events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT)
   \   00000D   EA           MOV       A,R2
   \   00000E   A2E0         MOV       C,0xE0 /* A   */.0
   \   000010   5078         JNC       ??SampleApp_ProcessEvent_1
    368            {
    369          
    370              // DHT11采集
    371              SampleApp_Send_P2P_Message();
   \   000012                ; Setup parameters for call to function SampleApp_Send_P2P_Message
   \   000012   12....       LCALL     `??SampleApp_Send_P2P_Message::?relay`; Banked call to: SampleApp_Send_P2P_Message
    372          
    373              // Setup to send message again in normal period (+ a little jitter)
    374              osal_start_timerEx(SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
    375                                 (SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT + (osal_rand() & 0x00FF)));
   \   000015                ; Setup parameters for call to function osal_rand
   \   000015   12....       LCALL     `??osal_rand::?relay`; Banked call to: osal_rand
   \   000018                ; Setup parameters for call to function osal_start_timerEx
   \   000018   EA           MOV       A,R2
   \   000019   24B8         ADD       A,#-0x48
   \   00001B   FC           MOV       R4,A
   \   00001C   E4           CLR       A
   \   00001D   340B         ADDC      A,#0xb
   \   00001F   FD           MOV       R5,A
   \   000020   7A01         MOV       R2,#0x1
   \   000022   7B00         MOV       R3,#0x0
   \   000024   90....       MOV       DPTR,#SampleApp_TaskID
   \   000027   E0           MOVX      A,@DPTR
   \   000028   F9           MOV       R1,A
   \   000029   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
    376          
    377              // return unprocessed events
    378              return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
   \   00002C   EE           MOV       A,R6
   \   00002D   6401         XRL       A,#0x1
   \   00002F   FA           MOV       R2,A
   \   000030   EF           MOV       A,R7
   \   000031   8054         SJMP      ??SampleApp_ProcessEvent_2
    379            }
   \                     ??SampleApp_ProcessEvent_3:
   \   000033   A3           INC       DPTR
   \   000034   E0           MOVX      A,@DPTR
   \   000035   90....       MOV       DPTR,#SampleApp_NwkState
   \   000038   F0           MOVX      @DPTR,A
   \   000039   6409         XRL       A,#0x9
   \   00003B   600A         JZ        ??SampleApp_ProcessEvent_4
   \   00003D   E0           MOVX      A,@DPTR
   \   00003E   6407         XRL       A,#0x7
   \   000040   6005         JZ        ??SampleApp_ProcessEvent_4
   \   000042   E0           MOVX      A,@DPTR
   \   000043   6406         XRL       A,#0x6
   \   000045   7010         JNZ       ??SampleApp_ProcessEvent_5
   \                     ??SampleApp_ProcessEvent_4:
   \   000047                ; Setup parameters for call to function osal_start_timerEx
   \   000047   7CB8         MOV       R4,#-0x48
   \   000049   7D0B         MOV       R5,#0xb
   \   00004B   7A01         MOV       R2,#0x1
   \   00004D   7B00         MOV       R3,#0x0
   \   00004F   90....       MOV       DPTR,#SampleApp_TaskID
   \   000052   E0           MOVX      A,@DPTR
   \   000053   F9           MOV       R1,A
   \   000054   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \                     ??SampleApp_ProcessEvent_5:
   \   000057                ; Setup parameters for call to function osal_msg_deallocate
   \   000057   AA..         MOV       R2,?V0
   \   000059   AB..         MOV       R3,?V1
   \   00005B   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??SampleApp_ProcessEvent_0:
   \   00005E                ; Setup parameters for call to function osal_msg_receive
   \   00005E   90....       MOV       DPTR,#SampleApp_TaskID
   \   000061   E0           MOVX      A,@DPTR
   \   000062   F9           MOV       R1,A
   \   000063   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   000066   8A..         MOV       ?V0,R2
   \   000068   8B..         MOV       ?V1,R3
   \   00006A   EA           MOV       A,R2
   \   00006B   4B           ORL       A,R3
   \   00006C   6014         JZ        ??SampleApp_ProcessEvent_6
   \   00006E   8A82         MOV       DPL,R2
   \   000070   8B83         MOV       DPH,R3
   \   000072   E0           MOVX      A,@DPTR
   \   000073   24E6         ADD       A,#-0x1a
   \   000075   6006         JZ        ??SampleApp_ProcessEvent_7
   \   000077   2449         ADD       A,#0x49
   \   000079   60B8         JZ        ??SampleApp_ProcessEvent_3
   \   00007B   80DA         SJMP      ??SampleApp_ProcessEvent_5
   \                     ??SampleApp_ProcessEvent_7:
   \   00007D                ; Setup parameters for call to function SampleApp_ProcessMSGCmd
   \   00007D   12....       LCALL     `??SampleApp_ProcessMSGCmd::?relay`; Banked call to: SampleApp_ProcessMSGCmd
   \   000080   80D5         SJMP      ??SampleApp_ProcessEvent_5
   \                     ??SampleApp_ProcessEvent_6:
   \   000082   EE           MOV       A,R6
   \   000083   FA           MOV       R2,A
   \   000084   EF           MOV       A,R7
   \   000085   6480         XRL       A,#0x80
   \                     ??SampleApp_ProcessEvent_2:
   \   000087   FB           MOV       R3,A
   \   000088   8004         SJMP      ??SampleApp_ProcessEvent_8
    380          
    381          #endif
    382          
    383            return (0); // Discard unknown events.
   \                     ??SampleApp_ProcessEvent_1:
   \   00008A   7A00         MOV       R2,#0x0
   \   00008C   7B00         MOV       R3,#0x0
   \                     ??SampleApp_ProcessEvent_8:
   \   00008E                REQUIRE ?Subroutine0
   \   00008E                ; // Fall through to label ?Subroutine0
    384          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F04         MOV       R7,#0x4
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    385          
    386          /*********************************************************************
    387           * @fn      SerialApp_ProcessMSGCmd
    388           *
    389           * @brief   Data message processor callback. This function processes
    390           *          any incoming data - probably from other devices. Based
    391           *          on the cluster ID, perform the intended action.
    392           *
    393           * @param   pkt - pointer to the incoming message packet
    394           *
    395           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    396           *          FALSE otherwise.
    397           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    398          void SampleApp_ProcessMSGCmd(afIncomingMSGPacket_t *pkt)
   \                     SampleApp_ProcessMSGCmd:
    399          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000   74F5         MOV       A,#-0xb
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 128
   \   000005   7480         MOV       A,#-0x80
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    400            uint8 buff[20] = {0};
    401          
    402            switch (pkt->clusterId)
   \   00000E   8A82         MOV       DPL,R2
   \   000010   F583         MOV       DPH,A
   \   000012   A3           INC       DPTR
   \   000013   A3           INC       DPTR
   \   000014   A3           INC       DPTR
   \   000015   A3           INC       DPTR
   \   000016   E0           MOVX      A,@DPTR
   \   000017   6404         XRL       A,#0x4
   \   000019   7002         JNZ       ??SampleApp_ProcessMSGCmd_0
   \   00001B   A3           INC       DPTR
   \   00001C   E0           MOVX      A,@DPTR
   \                     ??SampleApp_ProcessMSGCmd_0:
   \   00001D   6003         JZ        $+5
   \   00001F   02....       LJMP      ??SampleApp_ProcessMSGCmd_1 & 0xFFFF
    403            {
    404            // 接收终端上传的温度数据
    405            case SAMPLEAPP_P2P_CLUSTERID:
    406          #ifdef ZDO_COORDINATOR
    407            {
    408              end_temp = pkt->cmd.Data[0]; //终端温度
    409              end_hum = pkt->cmd.Data[1];  //终端湿度
    410          
    411              end_light = pkt->cmd.Data[2];     //终端亮度
    412              end_led2 = pkt->cmd.Data[3];      //led2
    413              end_obstacles = pkt->cmd.Data[4]; //障碍物
    414              end_smoke = pkt->cmd.Data[5];     //烟雾
    415          
    416              //cor_led3 = !cor_led3;
    417              sprintf(buff, "T:%d", end_temp);
    418              HalLcdWriteString(buff, HAL_LCD_LINE_3); //LCD显示
    419          
    420              sprintf(buff, "H:%d", end_hum);
    421              HalLcdWriteString(buff, HAL_LCD_LINE_4); //LCD显示
    422            }
    423          #endif
    424            break;
    425          
    426            case SAMPLEAPP_PERIODIC_CLUSTERID:
    427          
    428              break;
    429            case SAMPLEAPP_CTE_CLUSTERID: //coor to end 终端进行命令解析和处理
    430              char buf[128];
                     ^
Warning[Pe1072]: a declaration cannot have a label
    431              osal_memset(buf, '\0', 128);
   \   000022                ; Setup parameters for call to function osal_memset
   \   000022   7C80         MOV       R4,#-0x80
   \   000024   7D00         MOV       R5,#0x0
   \   000026   7900         MOV       R1,#0x0
   \   000028   AA..         MOV       R2,?XSP + 0
   \   00002A   AB..         MOV       R3,?XSP + 1
   \   00002C   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
    432              osal_memcpy(buf, pkt->cmd.Data, pkt->cmd.DataLength); //复制到缓冲区
   \   00002F                ; Setup parameters for call to function osal_memcpy
   \   00002F   EE           MOV       A,R6
   \   000030   2422         ADD       A,#0x22
   \   000032   F582         MOV       DPL,A
   \   000034   E4           CLR       A
   \   000035   3F           ADDC      A,R7
   \   000036   F583         MOV       DPH,A
   \   000038   E0           MOVX      A,@DPTR
   \   000039   F5..         MOV       ?V0,A
   \   00003B   A3           INC       DPTR
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   F5..         MOV       ?V1,A
   \   00003F   75..00       MOV       ?V2,#0x0
   \   000042   78..         MOV       R0,#?V0
   \   000044   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   000047   EE           MOV       A,R6
   \   000048   2420         ADD       A,#0x20
   \   00004A   F582         MOV       DPL,A
   \   00004C   E4           CLR       A
   \   00004D   3F           ADDC      A,R7
   \   00004E   F583         MOV       DPH,A
   \   000050   E0           MOVX      A,@DPTR
   \   000051   FC           MOV       R4,A
   \   000052   A3           INC       DPTR
   \   000053   E0           MOVX      A,@DPTR
   \   000054   FD           MOV       R5,A
   \   000055   7403         MOV       A,#0x3
   \   000057   12....       LCALL     ?XSTACK_DISP101_8
   \   00005A   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   00005D   7403         MOV       A,#0x3
   \   00005F   12....       LCALL     ?DEALLOC_XSTACK8
    433              HalUARTWrite(0, buf, osal_strlen(buf));               //串口输出提示信息
                                     ^
Warning[Pe167]: argument of type "char *" is incompatible with parameter of
          type "uint8 *"

    uint8 buff[20] = {0};
          ^
"C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",400  Warning[Pe177]: 
          variable "buff" was declared but never referenced
   \   000062                ; Setup parameters for call to function osal_strlen
   \   000062   AA..         MOV       R2,?XSP + 0
   \   000064   AB..         MOV       R3,?XSP + 1
   \   000066   12....       LCALL     ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000069                ; Setup parameters for call to function HalUARTWrite
   \   000069   AA..         MOV       R2,?XSP + 0
   \   00006B   AB..         MOV       R3,?XSP + 1
   \   00006D   12....       LCALL     ?Subroutine1 & 0xFFFF
    434              HalUARTWrite(0, "\r\n", 2);                           //串口输出提示信息
    435          
    436              if (strstr(buf, "D2:0"))
   \                     ??CrossCallReturnLabel_0:
   \   000070                ; Setup parameters for call to function strstr
   \   000070   7C..         MOV       R4,#`?<Constant "D2:0">` & 0xff
   \   000072   7D..         MOV       R5,#(`?<Constant "D2:0">` >> 8) & 0xff
   \   000074   AA..         MOV       R2,?XSP + 0
   \   000076   AB..         MOV       R3,?XSP + 1
   \   000078   12....       LCALL     `??strstr::?relay`; Banked call to: strstr
   \   00007B   EA           MOV       A,R2
   \   00007C   4B           ORL       A,R3
   \   00007D   6004         JZ        ??SampleApp_ProcessMSGCmd_2
    437                HalLedSet(HAL_LED_2, HAL_LED_MODE_OFF); //LED2
   \   00007F                ; Setup parameters for call to function HalLedSet
   \   00007F   7A00         MOV       R2,#0x0
   \   000081   8011         SJMP      ??SampleApp_ProcessMSGCmd_3
    438              else if (strstr(buf, "D2:1"))
   \                     ??SampleApp_ProcessMSGCmd_2:
   \   000083                ; Setup parameters for call to function strstr
   \   000083   7C..         MOV       R4,#`?<Constant "D2:1">` & 0xff
   \   000085   7D..         MOV       R5,#(`?<Constant "D2:1">` >> 8) & 0xff
   \   000087   AA..         MOV       R2,?XSP + 0
   \   000089   AB..         MOV       R3,?XSP + 1
   \   00008B   12....       LCALL     `??strstr::?relay`; Banked call to: strstr
   \   00008E   EA           MOV       A,R2
   \   00008F   4B           ORL       A,R3
   \   000090   6007         JZ        ??SampleApp_ProcessMSGCmd_4
    439                HalLedSet(HAL_LED_2, HAL_LED_MODE_ON); //LED2
   \   000092                ; Setup parameters for call to function HalLedSet
   \   000092   7A01         MOV       R2,#0x1
   \                     ??SampleApp_ProcessMSGCmd_3:
   \   000094   7902         MOV       R1,#0x2
   \   000096   12....       LCALL     `??HalLedSet::?relay`; Banked call to: HalLedSet
    440          
    441              // 蜂鸣器改为烟雾检测 P0_4
    442              // if (strstr(buf, "B:1"))
    443              //   P0_4 = 0;
    444              // else if (strstr(buf, "B:0"))
    445              //   P0_4 = 1;
    446          
    447              osal_memset(buf, '\0', 128);
   \                     ??SampleApp_ProcessMSGCmd_4:
   \   000099                ; Setup parameters for call to function osal_memset
   \   000099   7C80         MOV       R4,#-0x80
   \   00009B   7D00         MOV       R5,#0x0
   \   00009D   7900         MOV       R1,#0x0
   \   00009F   AA..         MOV       R2,?XSP + 0
   \   0000A1   AB..         MOV       R3,?XSP + 1
   \   0000A3   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
    448              break;
    449            default:
    450              break;
    451            }
    452          }
   \                     ??SampleApp_ProcessMSGCmd_1:
   \   0000A6   7480         MOV       A,#-0x80
   \   0000A8   12....       LCALL     ?DEALLOC_XSTACK8
   \   0000AB   7F03         MOV       R7,#0x3
   \   0000AD   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL     `??osal_strlen::?relay`; Banked call to: osal_strlen
   \   000003   8A..         MOV       ?V0,R2
   \   000005   8B..         MOV       ?V1,R3
   \   000007   AC..         MOV       R4,?V0
   \   000009   AD..         MOV       R5,?V1
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7900         MOV       R1,#0x0
   \   000002   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005   7C02         MOV       R4,#0x2
   \   000007   7D00         MOV       R5,#0x0
   \   000009   7A..         MOV       R2,#`?<Constant "\\r\\n">` & 0xff
   \   00000B   7B..         MOV       R3,#(`?<Constant "\\r\\n">` >> 8) & 0xff
   \   00000D   7900         MOV       R1,#0x0
   \   00000F   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
   \   000012   22           RET
    453          
    454          #ifdef ZDO_COORDINATOR
    455          
    456          //发送MQTT数据
    457          void ESP8266_SendData(char *buff, int len)
    458          {
    459            if (len == 0)
    460              return;
    461          
    462            HalUARTWrite(0, buff, len);
    463          }
    464          
    465          //接收到下发命令，或者接收到订阅的消息
    466          //topic:收到的主题
    467          //cmd::主题对应的内容
    468          void mqtt_rx(uint8 *topic, uint8 *cmd)
    469          {
    470            char *ptr_led3_on = NULL;
    471            char *ptr_led3_off = NULL;
    472          
    473            char *this_topic = NULL;
    474            //控制命令格式
    475            char uartbuf[] = {'D', '2', ':', ' ',
    476                              'B', ':', ' ', '\0'};
    477            //协调器收到数据后
    478            //根据设计决定数据如何处理
    479          
    480            if (topic == NULL || cmd == NULL)
    481              return;
    482          
    483            //我们只关心内容，即只关心CMD，不处理主题
    484          
    485            ptr_led3_on = strstr((char *)cmd, "\"led\":1");
    486            ptr_led3_off = strstr((char *)cmd, "\"led\":0");
    487          
    488            if (ptr_led3_on != NULL)
    489            {
    490              // coor led3
    491              //P1_4 = 0; //D3亮
    492              //cor_led3 = 1;
    493              uartbuf[3] = '1';
    494              uartbuf[6] = '1';
    495            }
    496            else if (ptr_led3_off != NULL)
    497            {
    498              // coor led3
    499              //P1_4 = 1; //D3灭
    500              //cor_led3 = 0;
    501              uartbuf[3] = '0';
    502              uartbuf[6] = '0';
    503            }
    504            HalLedBlink(HAL_LED_1, 5, 50, 500);
    505          
    506            AF_DataRequest(&SampleApp_P2P_DstAddr,  //&Endevice_Add,  //目的节点网络地址和发送格式
    507                           &SampleApp_epDesc,       //目的地址端口号
    508                           SAMPLEAPP_CTE_CLUSTERID, //命令号，用于区别命令 coor to end
    509                           7,                       //osal_strlen(uartbuf),    //发送数据的长度
    510                           uartbuf,                 //发送数据的缓冲区
    511                           &SampleApp_MsgID,        //发送序号,发完+1
    512                           AF_DISCV_ROUTE,
    513                           AF_DEFAULT_RADIUS);
    514          }
    515          
    516          void OneNet_publish_topic()
    517          {
    518            uint8 buff[20] = {0};
    519          
    520            sprintf(buff, "t:%d,h:%d", end_temp, end_hum);
    521          
    522            /*  发布主题为"hello_topic_public"，消息为温度和湿度 */
    523            if (0 == mqtt_publish_topic("hello_topic_public", buff))
    524            {
    525              ;
    526            }
    527          }
    528          
    529          /*********************************************************************
    530           * @fn      SampleApp_CallBack
    531           *
    532           * @brief   Send data OTA.
    533           *
    534           * @param   port - UART port.
    535           * @param   event - the UART port event flag.
    536           *
    537           * @return  none
    538           */
    539          uint32 lastReadMs = 0;
    540          void SampleApp_CallBack(uint8 port, uint8 event)
    541          {
    542            (void)port;
    543          
    544            if (0 == onenet_login_ok)
    545            {
    546              HalUARTRead(SAMPLE_APP_PORT, SampleApp_RxBuf, SAMPLE_APP_RX_MAX);
    547              SampleApp_RxLen = 0;
    548              osal_memset(SampleApp_RxBuf, 0, SAMPLE_APP_RX_MAX);
    549            }
    550            else if (1 == onenet_login_ok) //onenet注册成功 0:未注册，1：注册中　2：注册成功
    551            {
    552              //一个一个字节读
    553              SampleApp_RxLen += HalUARTRead(SAMPLE_APP_PORT, SampleApp_RxBuf + SampleApp_RxLen, 4);
    554          
    555              //判断是否是注册成功
    556              if (SampleApp_RxLen >= 4)
    557              {
    558                //        debug("rx len=%d(%x,%x,%x,%x)\r\n", SampleApp_RxLen,SampleApp_RxBuf[0],SampleApp_RxBuf[1],SampleApp_RxBuf[2],SampleApp_RxBuf[3]);
    559          
    560                //等待接入响应
    561                if (MQTT_UnPacketRecv(SampleApp_RxBuf) == MQTT_PKT_CONNACK)
    562                {
    563                  if (0 == MQTT_UnPacketConnectAck(SampleApp_RxBuf))
    564                  {
    565                    onenet_login_ok = 2; //注册成功
    566                    SampleApp_RxLen = 0;
    567          
    568                    //请求订阅主题
    569                    if (mqtt_subscribe_topic(g_mqtt_topics_set, 1) == 0)
    570                    {
    571                      //订阅成功P1_4  D3变为亮
    572                      P1_4 = 0;
    573                    }
    574                  }
    575                }
    576              }
    577          
    578              //数组满，清0
    579              if (SampleApp_RxLen >= SAMPLE_APP_RX_MAX)
    580              {
    581                SampleApp_RxLen = 0;
    582              }
    583            }
    584            else if (2 == onenet_login_ok)
    585            {
    586              //如果是注册成功，读服务器的控制命令
    587          
    588              uint32 curMs = osal_GetSystemClock();
    589          
    590              if ((curMs - lastReadMs) < 1000)
    591                return;
    592          
    593              lastReadMs = curMs;
    594              SampleApp_RxLen = 0;
    595              osal_memset(SampleApp_RxBuf, 0, SAMPLE_APP_RX_MAX + 1);
    596              SampleApp_RxLen = HalUARTRead(SAMPLE_APP_PORT, SampleApp_RxBuf, SAMPLE_APP_RX_MAX); //读长200的数据
    597          
    598              if (SampleApp_RxLen > 0)
    599              {
    600                debug("rx len=%d.\r\n", SampleApp_RxLen);
    601                //接收消息
    602                OneNet_RevPro(SampleApp_RxBuf);
    603                //debug LED3
    604                //        HalLedBlink (HAL_LED_3, 5, 50, 500); //HalLedSet
    605                SampleApp_RxLen = 0;
    606                osal_memset(SampleApp_RxBuf, 0, SAMPLE_APP_RX_MAX + 1);
    607              }
    608            }
    609          }
    610          
    611          #else
    612          #include "hal_ADC.h"
    613          /*********************************************************************
    614           * @fn      SampleApp_Send_P2P_Message
    615           *
    616           * @brief   point to point.
    617           *
    618           * @param   none
    619           *
    620           * @return  none
    621           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    622          void SampleApp_Send_P2P_Message(void)
   \                     SampleApp_Send_P2P_Message:
    623          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 30
   \   000005   74E2         MOV       A,#-0x1e
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    624            uint8 str[10] = {0};
   \   00000A   90....       MOV       DPTR,#`?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}>`
   \   00000D   AC..         MOV       R4,?XSP + 0
   \   00000F   AD..         MOV       R5,?XSP + 1
   \   000011   740A         MOV       A,#0xa
   \   000013   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    625            uint8 strTemp[20] = {0};
   \   000016   90....       MOV       DPTR,#`?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0`
   \   000019   740A         MOV       A,#0xa
   \   00001B   12....       LCALL     ?XSTACK_DISP102_8
   \   00001E   7414         MOV       A,#0x14
   \   000020   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    626            uint8 end_obstacles_temp = 0;
    627            uint8 end_buzzer_temp = 0;
    628            int len = 0;
    629          
    630            osal_memset(str, '\0', 10);
   \   000023                ; Setup parameters for call to function osal_memset
   \   000023   7C0A         MOV       R4,#0xa
   \   000025   FD           MOV       R5,A
   \   000026   F9           MOV       R1,A
   \   000027   AA..         MOV       R2,?XSP + 0
   \   000029   AB..         MOV       R3,?XSP + 1
   \   00002B   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
    631            osal_memset(strTemp, '\0', 20);
   \   00002E                ; Setup parameters for call to function osal_memset
   \   00002E   7C14         MOV       R4,#0x14
   \   000030   7D00         MOV       R5,#0x0
   \   000032   7900         MOV       R1,#0x0
   \   000034   740A         MOV       A,#0xa
   \   000036   12....       LCALL     ?XSTACK_DISP101_8
   \   000039   12....       LCALL     `??osal_memset::?relay`; Banked call to: osal_memset
    632          
    633            DHT11(); //获取温湿度
   \   00003C                ; Setup parameters for call to function DHT11
   \   00003C   12....       LCALL     `??DHT11::?relay`; Banked call to: DHT11
    634          
    635            HalAdcInit();
   \   00003F                ; Setup parameters for call to function HalAdcInit
   \   00003F   12....       LCALL     `??HalAdcInit::?relay`; Banked call to: HalAdcInit
    636            uint8 end_light_temp = HalAdcRead(HAL_ADC_CHANNEL_6, HAL_ADC_RESOLUTION_8); //P0_6
   \   000042                ; Setup parameters for call to function HalAdcRead
   \   000042   7A01         MOV       R2,#0x1
   \   000044   7906         MOV       R1,#0x6
   \   000046   12....       LCALL     `??HalAdcRead::?relay`; Banked call to: HalAdcRead
   \   000049   8A..         MOV       ?V0,R2
   \   00004B   AE..         MOV       R6,?V0
    637            uint8 end_smoke_temp = HalAdcRead(HAL_ADC_CHANNEL_4, HAL_ADC_RESOLUTION_8); //P0_4
   \   00004D                ; Setup parameters for call to function HalAdcRead
   \   00004D   7A01         MOV       R2,#0x1
   \   00004F   7904         MOV       R1,#0x4
   \   000051   12....       LCALL     `??HalAdcRead::?relay`; Banked call to: HalAdcRead
   \   000054   8A..         MOV       ?V0,R2
    638            uint8 end_led2_temp = 0;
    639          
    640            if (P1_1 == 1)
   \   000056   AB90         MOV       R3,0x90+0x0
    641              end_led2_temp = 0;
    642            else
    643              end_led2_temp = 1;
    644          
    645            //障碍物检查
    646            if (P0_5 == 1) //拉高
   \   000058   AA80         MOV       R2,0x80+0x0
    647            {
    648              end_obstacles_temp = 0;
    649            }
    650            else
    651              end_obstacles_temp = 1;
    652            str[0] = wendu; //温度
   \   00005A   90....       MOV       DPTR,#wendu
   \   00005D   E0           MOVX      A,@DPTR
   \   00005E   85..82       MOV       DPL,?XSP + 0
   \   000061   85..83       MOV       DPH,?XSP + 1
   \   000064   F0           MOVX      @DPTR,A
    653            str[1] = shidu; //湿度
   \   000065   90....       MOV       DPTR,#shidu
   \   000068   E0           MOVX      A,@DPTR
   \   000069   C0E0         PUSH      A
   \   00006B   7401         MOV       A,#0x1
   \   00006D   12....       LCALL     ?XSTACK_DISP0_8
   \   000070   D0E0         POP       A
   \   000072   F0           MOVX      @DPTR,A
    654          
    655            str[2] = end_light_temp;     //亮度
   \   000073   7402         MOV       A,#0x2
   \   000075   12....       LCALL     ?XSTACK_DISP0_8
   \   000078   EE           MOV       A,R6
   \   000079   F0           MOVX      @DPTR,A
    656            str[3] = end_led2_temp;      //led3状态
   \   00007A   EB           MOV       A,R3
   \   00007B   A2E1         MOV       C,0xE0 /* A   */.1
   \   00007D   4004         JC        ??SampleApp_Send_P2P_Message_0
   \   00007F   D2F0         SETB      B.0
   \   000081   8002         SJMP      ??SampleApp_Send_P2P_Message_1
   \                     ??SampleApp_Send_P2P_Message_0:
   \   000083   C2F0         CLR       B.0
   \                     ??SampleApp_Send_P2P_Message_1:
   \   000085   A2F0         MOV       C,B.0
   \   000087   E4           CLR       A
   \   000088   33           RLC       A
   \   000089   C0E0         PUSH      A
   \   00008B   7403         MOV       A,#0x3
   \   00008D   12....       LCALL     ?XSTACK_DISP0_8
   \   000090   D0E0         POP       A
   \   000092   F0           MOVX      @DPTR,A
    657            str[4] = end_obstacles_temp; //障碍物情况
   \   000093   EA           MOV       A,R2
   \   000094   A2E5         MOV       C,0xE0 /* A   */.5
   \   000096   4004         JC        ??SampleApp_Send_P2P_Message_2
   \   000098   D2F0         SETB      B.0
   \   00009A   8002         SJMP      ??SampleApp_Send_P2P_Message_3
   \                     ??SampleApp_Send_P2P_Message_2:
   \   00009C   C2F0         CLR       B.0
   \                     ??SampleApp_Send_P2P_Message_3:
   \   00009E   A2F0         MOV       C,B.0
   \   0000A0   E4           CLR       A
   \   0000A1   33           RLC       A
   \   0000A2   C0E0         PUSH      A
   \   0000A4   7404         MOV       A,#0x4
   \   0000A6   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A9   D0E0         POP       A
   \   0000AB   F0           MOVX      @DPTR,A
    658            str[5] = end_smoke_temp;     //烟雾数值
   \   0000AC   7405         MOV       A,#0x5
   \   0000AE   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B1   E5..         MOV       A,?V0
   \   0000B3   F0           MOVX      @DPTR,A
    659            //str[5] = end_buzzer_temp;    //buzzer情况
    660            len = 6;
    661            sprintf(strTemp, "T&H:%d %d", str[0], str[1]);
                           ^
Warning[Pe167]: argument of type "uint8 *" is incompatible with parameter of
          type "char *"
   \   0000B4                ; Setup parameters for call to function sprintf
   \   0000B4   7401         MOV       A,#0x1
   \   0000B6   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B9   E0           MOVX      A,@DPTR
   \   0000BA   F5..         MOV       ?V0,A
   \   0000BC   75..00       MOV       ?V1,#0x0
   \   0000BF   78..         MOV       R0,#?V0
   \   0000C1   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000C4   7402         MOV       A,#0x2
   \   0000C6   12....       LCALL     ?XSTACK_DISP0_8
   \   0000C9   E0           MOVX      A,@DPTR
   \   0000CA   F5..         MOV       ?V0,A
   \   0000CC   78..         MOV       R0,#?V0
   \   0000CE   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000D1   7C..         MOV       R4,#`?<Constant "T&H:%d %d">` & 0xff
   \   0000D3   7D..         MOV       R5,#(`?<Constant "T&H:%d %d">` >> 8) & 0xff
   \   0000D5   740E         MOV       A,#0xe
   \   0000D7   12....       LCALL     ?XSTACK_DISP101_8
   \   0000DA   12....       LCALL     `??sprintf::?relay`; Banked call to: sprintf
   \   0000DD   7404         MOV       A,#0x4
   \   0000DF   12....       LCALL     ?DEALLOC_XSTACK8
    662            HalLcdWriteString(strTemp, HAL_LCD_LINE_3); //LCD显示
                                     ^
Warning[Pe167]: argument of type "uint8 *" is incompatible with parameter of
          type "char *"
   \   0000E2                ; Setup parameters for call to function HalLcdWriteString
   \   0000E2   7903         MOV       R1,#0x3
   \   0000E4   740A         MOV       A,#0xa
   \   0000E6   12....       LCALL     ?XSTACK_DISP101_8
   \   0000E9   12....       LCALL     `??HalLcdWriteString::?relay`; Banked call to: HalLcdWriteString
    663          
    664            HalUARTWrite(0, strTemp, osal_strlen(strTemp)); //串口输出提示信息
                                                        ^
Warning[Pe167]: argument of type "uint8 *" is incompatible with parameter of
          type "char *"
   \   0000EC                ; Setup parameters for call to function osal_strlen
   \   0000EC   740A         MOV       A,#0xa
   \   0000EE   12....       LCALL     ?XSTACK_DISP101_8
   \   0000F1   12....       LCALL     ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000F4                ; Setup parameters for call to function HalUARTWrite
   \   0000F4   740A         MOV       A,#0xa
   \   0000F6   12....       LCALL     ?XSTACK_DISP101_8
   \   0000F9   12....       LCALL     ?Subroutine1 & 0xFFFF
    665            HalUARTWrite(0, "\r\n", 2);
    666          
    667            //无线发送到协调器
    668            if (AF_DataRequest(&SampleApp_P2P_DstAddr, &SampleApp_epDesc,
    669                               SAMPLEAPP_P2P_CLUSTERID,
    670                               osal_strlen(str), //这个有bugosal得出33
                                                  ^
Warning[Pe167]: argument of type "uint8 *" is incompatible with parameter of
          type "char *"

    uint8 end_buzzer_temp = 0;
          ^
"C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",627  Warning[Pe177]: 
          variable "end_buzzer_temp" was declared but never referenced

    int len = 0;
        ^
"C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",628  Warning[Pe550]: 
          variable "len" was set but never used

  static uint16 SampleApp_RxLen = 0;
                ^
"C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",106  Warning[Pe177]: 
          variable "SampleApp_RxLen" was declared but never referenced

  static void OneNet_publish_topic();
              ^
"C:\Users\OY\Desktop\ing\new\ZStack-2.5.1a\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",132  Warning[Pe177]: 
          function "OneNet_publish_topic" was declared but never referenced
    671                               str,
    672                               &SampleApp_MsgID,
    673                               AF_DISCV_ROUTE,
    674                               AF_DEFAULT_RADIUS) == afStatus_SUCCESS)
   \                     ??CrossCallReturnLabel_1:
   \   0000FC                ; Setup parameters for call to function osal_strlen
   \   0000FC   AA..         MOV       R2,?XSP + 0
   \   0000FE   AB..         MOV       R3,?XSP + 1
   \   000100   12....       LCALL     `??osal_strlen::?relay`; Banked call to: osal_strlen
   \   000103   8A..         MOV       ?V0,R2
   \   000105   8B..         MOV       ?V1,R3
   \   000107                ; Setup parameters for call to function AF_DataRequest
   \   000107   75..1E       MOV       ?V2,#0x1e
   \   00010A   78..         MOV       R0,#?V2
   \   00010C   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00010F   75....       MOV       ?V2,#SampleApp_MsgID & 0xff
   \   000112   75....       MOV       ?V3,#(SampleApp_MsgID >> 8) & 0xff
   \   000115   78..         MOV       R0,#?V2
   \   000117   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00011A   7403         MOV       A,#0x3
   \   00011C   12....       LCALL     ?XSTACK_DISP100_8
   \   00011F   88..         MOV       ?V2,R0
   \   000121   89..         MOV       ?V3,R1
   \   000123   78..         MOV       R0,#?V2
   \   000125   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000128   78..         MOV       R0,#?V0
   \   00012A   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00012D   75..01       MOV       ?V0,#0x1
   \   000130   75..00       MOV       ?V1,#0x0
   \   000133   78..         MOV       R0,#?V0
   \   000135   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000138   7920         MOV       R1,#0x20
   \   00013A   7C..         MOV       R4,#SampleApp_epDesc & 0xff
   \   00013C   7D..         MOV       R5,#(SampleApp_epDesc >> 8) & 0xff
   \   00013E   7A..         MOV       R2,#SampleApp_P2P_DstAddr & 0xff
   \   000140   7B..         MOV       R3,#(SampleApp_P2P_DstAddr >> 8) & 0xff
   \   000142   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000145   7409         MOV       A,#0x9
   \   000147   12....       LCALL     ?DEALLOC_XSTACK8
    675            {
    676            }
    677            else
    678            {
    679              // Error occurred in request to send.
    680            }
    681          }
   \   00014A   741E         MOV       A,#0x1e
   \   00014C   12....       LCALL     ?DEALLOC_XSTACK8
   \   00014F   02....       LJMP      ?Subroutine0 & 0xFFFF
   \   000152                REQUIRE _A_P1
   \   000152                REQUIRE _A_P0
    682          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    683          void SampleApp_CallBack(uint8 port, uint8 event)
   \                     SampleApp_CallBack:
    684          {
   \   000000   C082         PUSH      DPL
   \   000002   C083         PUSH      DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    685            (void)port;
    686          
    687            HalUARTRead(SAMPLE_APP_PORT, SampleApp_RxBuf, 1);
   \   000004                ; Setup parameters for call to function HalUARTRead
   \   000004   7C01         MOV       R4,#0x1
   \   000006   7D00         MOV       R5,#0x0
   \   000008   7A..         MOV       R2,#SampleApp_RxBuf & 0xff
   \   00000A   7B..         MOV       R3,#(SampleApp_RxBuf >> 8) & 0xff
   \   00000C   7900         MOV       R1,#0x0
   \   00000E   12....       LCALL     `??HalUARTRead::?relay`; Banked call to: HalUARTRead
    688          }
   \   000011   D083         POP       DPH
   \   000013   D082         POP       DPL
   \   000015   02....       LJMP      ?BRET
    689          
    690          #endif
    691          
    692          //调试信息输出

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    693          void debug(uint8 *msg, ...)
   \                     debug:
    694          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    695          #if 0
    696              uint8 len=0;
    697              char info[200] = {0};
    698              va_list args;
    699          
    700              if(msg==NULL) return;
    701          
    702              va_start(args, msg);
    703              vsprintf(info, (const char*)msg, args);//从头插入到info中
    704              va_end(args);
    705              
    706              
    707              len=osal_strlen((char *)info);
    708              if(len==0) return;
    709              
    710              
    711          
    712              HalUARTWrite(1,info, len);//串口1发送
    713              osal_memset(info,'\0',200);
    714          //    HAL_UART_PORT_0
    715          #endif
    716          }
   \   000000   02....       LJMP      ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for SampleApp_epDesc>`:
   \   000000   0B           DB 11
   \   000001   ....         DW SampleApp_TaskID
   \   000003   ....         DW SampleApp_SimpleDesc
   \   000005   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "\\r\\n">`:
   \   000000   0D0A00       DB "\015\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "D2:0">`:
   \   000000   44323A30     DB "D2:0"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "D2:1">`:
   \   000000   44323A31     DB "D2:1"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}>`:
   \   000000   00           DB 0
   \   000001   00           DB 0
   \   000002   00           DB 0
   \   000003   00           DB 0
   \   000004   00           DB 0
   \   000005   00           DB 0
   \   000006   00           DB 0
   \   000007   00           DB 0
   \   000008   00           DB 0
   \   000009   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0`:
   \   000000   00           DB 0
   \   000001   00           DB 0
   \   000002   00           DB 0
   \   000003   00           DB 0
   \   000004   00           DB 0
   \   000005   00           DB 0
   \   000006   00           DB 0
   \   000007   00           DB 0
   \   000008   00           DB 0
   \   000009   00           DB 0
   \   00000A   00           DB 0
   \   00000B   00           DB 0
   \   00000C   00           DB 0
   \   00000D   00           DB 0
   \   00000E   00           DB 0
   \   00000F   00           DB 0
   \   000010   00           DB 0
   \   000011   00           DB 0
   \   000012   00           DB 0
   \   000013   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "T&H:%d %d">`:
   \   000000   5426483A     DB "T&H:%d %d"
   \            25642025
   \            6400    

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      2      0   SampleApp_CallBack
        2      0   -> HalUARTRead
      0      0   SampleApp_HandleKeys
      0      9   SampleApp_Init
        0      9   -> MT_UartInit
        0      9   -> MT_UartRegisterTaskID
        0      9   -> RegisterForKeys
        0      9   -> afRegister
      0     12   SampleApp_ProcessEvent
        0     12   -> SampleApp_ProcessMSGCmd
        0     12   -> SampleApp_Send_P2P_Message
        0     12   -> osal_msg_deallocate
        0     12   -> osal_msg_receive
        0     12   -> osal_rand
        0     12   -> osal_start_timerEx
      0    154   SampleApp_ProcessMSGCmd
        0    139   -> HalLedSet
        0    139   -> HalUARTWrite
        0    142   -> osal_memcpy
        0    139   -> osal_memset
        0    139   -> osal_strlen
        0    139   -> strstr
      1     63   SampleApp_Send_P2P_Message
        0     51   -> AF_DataRequest
        0     42   -> DHT11
        0     42   -> HalAdcInit
        0     42   -> HalAdcRead
        0     42   -> HalLcdWriteString
        0     42   -> HalUARTWrite
        0     42   -> osal_memset
        0     42   -> osal_strlen
        0     46   -> sprintf
      0      0   debug


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       5  ?<Constant "D2:0">
       5  ?<Constant "D2:1">
      10  ?<Constant "T&H:%d %d">
       3  ?<Constant "\r\n">
      20  ?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
      10  ?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}>
       6  ?<Initializer for SampleApp_epDesc>
       5  ?Subroutine0
      19  ?Subroutine1
      12  ?Subroutine2
       1  P0DIR
       1  P0SEL
      24  SampleApp_CallBack
       8  SampleApp_ClusterList
       3  SampleApp_HandleKeys
      67  SampleApp_Init
       1  SampleApp_MsgID
       1  SampleApp_NwkState
      12  SampleApp_P2P_DstAddr
     142  SampleApp_ProcessEvent
     176  SampleApp_ProcessMSGCmd
     201  SampleApp_RxBuf
     338  SampleApp_Send_P2P_Message
      12  SampleApp_SimpleDesc
       1  SampleApp_TaskID
       6  SampleApp_epDesc
       1  _A_P0
       1  _A_P1
       1  cor_led3
       3  debug
       1  end_buzzer
       1  end_hum
       1  end_led2
       1  end_light
       1  end_obstacles
       1  end_smoke
       1  end_temp
       1  onenet_login_ok
      42  -- Other

 
 789 bytes in segment BANKED_CODE
  42 bytes in segment BANK_RELAYS
   4 bytes in segment SFR_AN
   6 bytes in segment XDATA_I
   6 bytes in segment XDATA_ID
  73 bytes in segment XDATA_ROM_C
 225 bytes in segment XDATA_Z
 
  48 bytes of CODE     memory
  73 bytes of CONST    memory
   0 bytes of DATA     memory (+ 4 bytes shared)
 789 bytes of HUGECODE memory
 231 bytes of XDATA    memory

Errors: none
Warnings: 13
